"use strict";(self.webpackChunkpoints=self.webpackChunkpoints||[]).push([[2222],{8948:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>h});var s=t(4848),i=t(8453);const o={sidebar_position:2},r="Point-Conversion",a={id:"advanced-guide/point-conversion",title:"Point-Conversion",description:"The process of giving users an on-chain representation of the off-chain points they collected on a particular protocol is called point-conversion. Let's break down this process into steps:",source:"@site/docs/advanced-guide/point-conversion.md",sourceDirName:"advanced-guide",slug:"/advanced-guide/point-conversion",permalink:"/web3-points/docs/advanced-guide/point-conversion",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/advanced-guide/point-conversion.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Point Factory",permalink:"/web3-points/docs/advanced-guide/point-factory"}},c={},h=[];function l(e){const n={h1:"h1",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"point-conversion",children:"Point-Conversion"}),"\n",(0,s.jsxs)(n.p,{children:["The process of giving users an on-chain representation of the off-chain points they collected on a particular protocol is called ",(0,s.jsx)(n.strong,{children:"point-conversion"}),". Let's break down this process into steps:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Company Part"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"An onboarded company uploads an updated version of their users' off-chain point balance periodically (depends on the company | could be daily, twice a week, etc...)."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"User Part"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"A user connects their wallet account to Monet platform. They will be able to see the different off-chain point balances they have over different protocols, -collected using this wallet account-."}),"\n",(0,s.jsx)(n.li,{children:"A user can see their total collected off-chain points -according to the most recent point balance sheet submitted to Monet by the company-, their already-converted points, and their convertible points (total off-chain points minus already-converted points)."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Website Level"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["When a user decides to convert some off-chain points into on-chain points, they will be asked to select the number of off-chain points they want to convert. This number should be ",(0,s.jsx)(n.strong,{children:"less than or equal to"})," the convertible points value (mentioned in Step2)."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Once the user chooses the amount of points they want to convert, and hit the submit button, a chain of actions will be triggered, as described in the next lines:"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["First, the UI will ensure that the amount the user is trying to convert is less than or equal to this user\u2019s convertible points. When that\u2019s assured, the backend will ",(0,s.jsx)(n.strong,{children:"build a unique message"})," that includes details such as:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"the user\u2019s address."}),"\n",(0,s.jsx)(n.li,{children:"the amount of points to-be-converted."}),"\n",(0,s.jsx)(n.li,{children:"a unique nonce of the user."}),"\n",(0,s.jsx)(n.li,{children:"the point contract address.\nAlong with other details."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"This message will be hashed, then signed using Monet account\u2019s private key."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"This signature (the signed hashed-message) will be used later on the smart contract level to validate the conversion of points."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The process of the signature creation:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Signature Creation",src:t(6192).A+"",width:"3236",height:"442"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Then, the frontend will ask the user to sign a transaction. This transaction represents a function call (The function that ",(0,s.jsx)(n.strong,{children:"mints"})," on-chain points in the point contract), and includes -as arguments- the ",(0,s.jsx)(n.strong,{children:"amount"})," of points that the user wants to convert on-chain, along with the ",(0,s.jsx)(n.strong,{children:"signature"})," created by the backend."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Smart Contract Level"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["When the ",(0,s.jsx)(n.strong,{children:"mint"})," function of the smart contract gets called, it will ",(0,s.jsx)(n.strong,{children:"decode"})," the signature that got passed to it. The result of decoding ",(0,s.jsx)(n.strong,{children:"the right signature"})," is a ",(0,s.jsx)(n.strong,{children:"hashed message"}),", along with the ",(0,s.jsx)(n.strong,{children:"Signer"})," of it (the hashed-message built in the backend in step3, along with the signer of that message, which is Monet account)."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["If the signer that the contract got after decoding the signature is not Monet, it means that the signature is ",(0,s.jsx)(n.strong,{children:"invalid"}),". The transaction will revert, and no points will be minted (created)."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["If the signer turns out to be Monet, the contract will start ",(0,s.jsx)(n.strong,{children:"rebuilding"})," the hashed message that was created at the website level (in step3)."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The process of rebuilding the hashed message goes as follows:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Rebuilding the hashed message",src:t(6132).A+"",width:"3332",height:"518"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Once the message is rebuilt, it gets hashed, then compared with the hashed-message that was created at the website level and extracted from the signature."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["If the two hashes ",(0,s.jsx)(n.strong,{children:"are the same"}),", this means that this is a ",(0,s.jsx)(n.strong,{children:"valid signature"}),", and the minting process goes through."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["If the two hashes are ",(0,s.jsx)(n.strong,{children:"not the same"}),", the transaction will revert, and no points will be minted."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["When a valid signature is used, it gets stored in the contract, and it ",(0,s.jsx)(n.strong,{children:"can\u2019t be used again"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},6132:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/rebuild-hash-message-26071b9fa36b9516dc48f238ccd633d8.png"},6192:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/signature-creation-0dea4eb8bb05fca3c62800d0a721a381.png"},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(6540);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);